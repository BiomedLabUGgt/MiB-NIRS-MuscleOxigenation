\doxysection{/\+\+Users/\+juliofajardo/\+\+Documents/\+\+ARM/\+\+Slides\+Nuevos/\+\+NIRS-\/\+MAX30101/\+\+Project/\+\+MAX30101.\+c}
\hypertarget{_2_users_2juliofajardo_2_documents_2_a_r_m_2_slides_nuevos_2_n_i_r_s-_m_a_x30101_2_project_2_m_a_x30101_8c-example}{}\label{_2_users_2juliofajardo_2_documents_2_a_r_m_2_slides_nuevos_2_n_i_r_s-_m_a_x30101_2_project_2_m_a_x30101_8c-example}Initialize MAX30101 in Sp\+O2 mode (dual-\/\+LED configuration).

Initialize MAX30101 in Sp\+O2 mode (dual-\/\+LED configuration) Configures sensor for blood oxygen (Sp\+O2) measurement with low power consumption.
\begin{DoxyItemize}
\item Mode:\+ Sp\+O2 (Red + IR LEDs)
\item Sample Rate:\+ 50 Hz
\item ADC Resolution:\+ 16-\/bit
\item FIFO Configuration:\+ Averaging 8, rollover enabled
\item LED Power:\+ Low (minimal power draw, suitable for wearables)
\item Temperature Sensor:\+ Enabled 
\begin{DoxyParams}{Parameters}
{\em None} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
Suitable for battery-\/powered wearable applications. Call this once during initialization before reading samples. 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
MAX30101\+\_\+\+Init\+Muscle\+Ox
\end{DoxySeeAlso}
MAX30101\+\_\+\+Init\+SPO2\+Lite(); uint8\+\_\+t samples = MAX30101\+\_\+\+Get\+Num\+Available\+Samples();
\end{DoxyItemize}


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}\doxymbox{\hyperlink{_m_a_x30101_8h}{MAX30101.h}}"{}}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ "{}\doxymbox{\hyperlink{_i2_c_8h}{I2C.h}}"{}}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Initialize\ MAX30101\ in\ SpO2\ mode\ (dual-\/LED\ configuration)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Configures\ sensor\ for\ blood\ oxygen\ (SpO2)\ measurement\ with\ low\ power\ consumption.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ Mode:\ SpO2\ (Red\ +\ IR\ LEDs)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ Sample\ Rate:\ 50\ Hz}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ ADC\ Resolution:\ 16-\/bit}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ FIFO\ Configuration:\ Averaging\ 8,\ rollover\ enabled}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ LED\ Power:\ Low\ (minimal\ power\ draw,\ suitable\ for\ wearables)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ Temperature\ Sensor:\ Enabled}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ None}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ void}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ Suitable\ for\ battery-\/powered\ wearable\ applications.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ Call\ this\ once\ during\ initialization\ before\ reading\ samples.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_InitMuscleOx}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_InitSPO2Lite();}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ uint8\_t\ samples\ =\ MAX30101\_GetNumAvailableSamples();}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ MAX30101\_InitSPO2Lite(\textcolor{keywordtype}{void})\{}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ FIFO\_CONFIG,\ 0x4F);\ \ \ \ \ \ \textcolor{comment}{//\ FIFO\ avg\ 8,\ FIFO\ rollover\ enabled}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ MODE\_CONFIG,\ 0x03);\ \ \ \ \ \ \textcolor{comment}{//\ SPO2\ Mode\ (Red\ +\ IR)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ SPO2\_CONFIG,\ 0x23);\ \ \ \ \ \ \textcolor{comment}{//\ 2048\ range,\ sample\ rate\ 50\ Hz,\ pulse\ width\ 215\ (16\ bits)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ FIFO\_READPTR,\ 0x0);\ \ \ \ \ \ \textcolor{comment}{//\ Reset\ FIFO\ read\ pointer}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ FIFO\_WRITPTR,\ 0x0);\ \ \ \ \ \ \textcolor{comment}{//\ Reset\ FIFO\ write\ pointer}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ LED1\_PAMPLI,\ 0x18);\ \ \ \ \ \ \textcolor{comment}{//\ Red\ LED\ power\ (low)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ LED2\_PAMPLI,\ 0x18);\ \ \ \ \ \ \textcolor{comment}{//\ IR\ LED\ power\ (low)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ DIE\_TEMPCFG,\ 0x01);\ \ \ \ \ \ \textcolor{comment}{//\ Enable\ temperature\ sensor}}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Initialize\ MAX30101\ for\ NIRS\ muscle\ oxygenation\ measurement}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Configures\ sensor\ for\ Near-\/Infrared\ Spectroscopy\ with\ 3\ simultaneous\ LEDs.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Optimal\ for\ non-\/invasive\ tissue\ oxygenation\ and\ perfusion\ monitoring.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ Mode:\ Multi-\/LED\ (Red\ +\ IR\ +\ Green)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ Sample\ Rate:\ 100\ Hz}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ ADC\ Resolution:\ 16-\/bit}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ FIFO\ Configuration:\ Averaging\ 8,\ rollover\ enabled}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ -\/\ Temperature\ Sensor:\ Enabled}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ ledPower\ -\/\ LED\ current\ control\ register\ value\ (0x00\ to\ 0xFF)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Range:\ 4.4\ mA\ to\ 50.6\ mA\ in\ \string~0.2\ mA\ steps}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Typical:\ 0x4B\ (\string~20\ mA),\ 0x18\ (\string~10\ mA)\ for\ low\ power}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ void}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ Higher\ sample\ rate\ (100\ Hz)\ vs\ SPO2Lite\ (50\ Hz)\ provides\ better\ temporal\ resolution.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ Three-\/LED\ configuration\ increases\ tissue\ penetration\ depth\ for\ muscle\ assessment.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_InitSPO2Lite}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_InitMuscleOx(0x4B);\ \ //\ 20\ mA\ LED\ power}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ uint8\_t\ available\ =\ MAX30101\_GetNumAvailableSamples();}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_ReadFIFO\_Current(current\_buffer,\ available);}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ MAX30101\_InitMuscleOx(uint8\_t\ ledPower)\{}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ FIFO\_CONFIG,\ 0x4F);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ FIFO\ avg\ 8,\ FIFO\ rollover\ enabled}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ MODE\_CONFIG,\ 0x07);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Multi-\/LED\ mode\ (Red\ +\ IR\ +\ Green)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ SPO2\_CONFIG,\ 0x26);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2048\ range,\ sample\ rate\ 100\ Hz,\ pulse\ width\ 215\ (16\ bits)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ FIFO\_READPTR,\ 0x0);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ FIFO\ read\ pointer}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ FIFO\_WRITPTR,\ 0x0);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ FIFO\ write\ pointer\ }}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ LED1\_PAMPLI,\ ledPower);\ \ \ \ \ \textcolor{comment}{//\ Red\ LED\ power\ (medium)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ LED2\_PAMPLI,\ ledPower);\ \ \ \ \ \textcolor{comment}{//\ IR\ LED\ power\ (medium)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ LED3\_PAMPLI,\ ledPower);\ \ \ \ \ \textcolor{comment}{//\ Green\ LED\ power\ (medium)}}
\DoxyCodeLine{\ \ \ \ I2C1\_Write(SENSOR\_ADDR,\ DIE\_TEMPCFG,\ 0x01);\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enable\ temperature\ sensor}}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Query\ FIFO\ status\ from\ MAX30101\ sensor}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Reads\ FIFO\ write\ and\ read\ pointer\ registers\ to\ determine\ number\ of\ unread\ samples.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Accounts\ for\ circular\ 32-\/sample\ FIFO\ with\ pointer\ wrap-\/around.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ None}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ uint8\_t\ Number\ of\ complete\ samples\ available\ (0\ to\ 32)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ -\/\ Returns\ 0\ if\ FIFO\ empty\ or\ pointers\ equal}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ -\/\ Returns\ 1\ to\ 32\ for\ available\ samples}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ Call\ this\ before\ MAX30101\_ReadFIFO()\ or\ MAX30101\_ReadFIFO\_Current()}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ to\ check\ if\ new\ data\ is\ ready.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @warning\ Multiple\ fast\ consecutive\ reads\ may\ show\ inconsistent\ results}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ due\ to\ FIFO\ updates\ during\ pointer\ reads.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_ReadFIFO,\ MAX30101\_ReadFIFO\_Current}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ uint8\_t\ count\ =\ MAX30101\_GetNumAvailableSamples();}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ if\ (count\ >\ 0)\ \{}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ MAX30101\_ReadFIFO\_Current(samples,\ count);}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \}}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{uint8\_t\ MAX30101\_GetNumAvailableSamples(\textcolor{keywordtype}{void})\{}
\DoxyCodeLine{\ \ \ \ uint8\_t\ write\_ptr\ =\ 0;}
\DoxyCodeLine{\ \ \ \ uint8\_t\ read\_ptr\ =\ 0;}
\DoxyCodeLine{\ \ \ \ uint8\_t\ num\_samples\ =\ 0;}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Read\ FIFO\ write\ pointer\ and\ read\ pointer\ from\ sensor}}
\DoxyCodeLine{\ \ \ \ I2C1\_Read(SENSOR\_ADDR,\ FIFO\_WRITPTR,\ \&write\_ptr,\ 1);}
\DoxyCodeLine{\ \ \ \ I2C1\_Read(SENSOR\_ADDR,\ FIFO\_READPTR,\ \&read\_ptr,\ 1);}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Mask\ to\ 5\ bits\ since\ FIFO\ pointers\ are\ 5\ bits\ (0-\/31)}}
\DoxyCodeLine{\ \ \ \ write\_ptr\ \&=\ 0x1F;}
\DoxyCodeLine{\ \ \ \ read\_ptr\ \&=\ 0x1F;}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Calculate\ available\ samples}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (write\_ptr\ >=\ read\_ptr)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ num\_samples\ =\ write\_ptr\ -\/\ read\_ptr;}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ num\_samples\ =\ (32\ -\/\ read\_ptr)\ +\ write\_ptr;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ num\_samples;}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Read\ raw\ FIFO\ data\ from\ MAX30101\ (intermediate\ format)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Streams\ raw\ 2-\/byte\ ADC\ samples\ sequentially\ from\ each\ channel.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Data\ is\ organized\ as:\ Red(2B)\ IR(2B)\ Green(2B)\ repeating.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Each\ complete\ sample\ requires\ 6\ bytes\ from\ FIFO.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ samples\ -\/\ [out]\ Pointer\ to\ buffer\ of\ MAX30101\_Sample\ structures\ to\ populate}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ num\_samples\ -\/\ [in]\ Number\ of\ complete\ samples\ to\ read\ (max\ 32)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ void}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @retval\ N/A}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ This\ is\ the\ lowest-\/level\ FIFO\ read.\ For\ processed\ data\ in\ nanoamps,}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ use\ MAX30101\_ReadFIFO\_Current()\ instead\ to\ skip\ intermediate\ conversion.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @warning\ Ensure\ buffer\ has\ capacity\ for\ num\_samples\ structures.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_ReadFIFO\_Current,\ MAX30101\_ConvertSampleToUint16}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_Sample\ raw[32];}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_ReadFIFO(raw,\ 5);\ \ //\ Read\ 5\ samples}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ MAX30101\_ReadFIFO(\doxymbox{\hyperlink{struct_m_a_x30101___sample}{MAX30101\_Sample}}\ *samples,\ uint8\_t\ num\_samples)\{}
\DoxyCodeLine{\ \ \ \ uint8\_t\ i\ =\ 0;}
\DoxyCodeLine{\ \ \ \ uint8\_t\ fifo\_data[8];\ \ \textcolor{comment}{//\ 6\ bytes\ per\ complete\ sample\ (3\ channels\ ×\ 2\ bytes)}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_samples;\ i++)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Read\ 6\ consecutive\ bytes\ from\ FIFO\_DATAREG}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Each\ I2C\ read\ from\ address\ 0x07\ gets\ the\ next\ byte\ in\ the\ FIFO}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ I2C1\_Read(SENSOR\_ADDR,\ FIFO\_DATAREG,\ fifo\_data,\ 6);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ the\ 2-\/byte\ samples\ for\ each\ channel}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_a4230155679f4357f2a47ca753fb46f0c}{red}}[0]\ =\ fifo\_data[0];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_a4230155679f4357f2a47ca753fb46f0c}{red}}[1]\ =\ fifo\_data[1];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_a6eaf385c919852b0eda0d281580943cd}{ir}}[0]\ =\ fifo\_data[2];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_a6eaf385c919852b0eda0d281580943cd}{ir}}[1]\ =\ fifo\_data[3];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_aa5668b987f1862331ffb4868ab9d0864}{green}}[0]\ =\ fifo\_data[4];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_aa5668b987f1862331ffb4868ab9d0864}{green}}[1]\ =\ fifo\_data[5];}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Convert\ raw\ byte\ pairs\ to\ 16-\/bit\ ADC\ counts}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Combines\ 2\ raw\ bytes\ (MSB,\ LSB)\ into\ 16-\/bit\ unsigned\ integers\ per\ channel.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ No\ scaling\ applied—output\ is\ raw\ ADC\ count\ (0–65535).}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ sample\_in\ -\/\ [in]\ Pointer\ to\ MAX30101\_Sample\ with\ raw\ 2-\/byte\ data}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ sample\_out\ -\/\ [out]\ Pointer\ to\ MAX30101\_SampleData\ for\ converted\ counts}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ void}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @retval\ N/A}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ This\ is\ typically\ an\ intermediate\ step.\ For\ direct\ nanoamp\ values,}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ use\ MAX30101\_ConvertUint16ToCurrent()\ after\ this\ or\ use}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ MAX30101\_ReadFIFO\_Current()\ to\ bypass\ intermediate\ storage.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_ConvertUint16ToCurrent,\ MAX30101\_ReadFIFO\_Current}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_Sample\ raw;}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_SampleData\ counts;}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_ReadFIFO(\&raw,\ 1);}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_ConvertSampleToUint16(\&raw,\ \&counts);\ \ //\ counts.red\ =\ 0-\/65535}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ MAX30101\_ConvertSampleToUint16(\doxymbox{\hyperlink{struct_m_a_x30101___sample}{MAX30101\_Sample}}\ *sample\_in,\ \doxymbox{\hyperlink{struct_m_a_x30101___sample_data}{MAX30101\_SampleData}}\ *sample\_out)\{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Convert\ Red\ LED:\ combine\ 2\ bytes\ into\ 16-\/bit\ uint16\_t}}
\DoxyCodeLine{\ \ \ \ sample\_out-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_data_aa6c4a1b80cef822bc20df87c653812e8}{red}}\ =\ ((uint16\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_a4230155679f4357f2a47ca753fb46f0c}{red}}[0]\ <<\ 8)\ |\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint16\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_a4230155679f4357f2a47ca753fb46f0c}{red}}[1]);}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Convert\ IR\ LED:\ combine\ 2\ bytes\ into\ 16-\/bit\ uint16\_t}}
\DoxyCodeLine{\ \ \ \ sample\_out-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_data_a57dfa08dd110be1f466596d1e6080f03}{ir}}\ =\ ((uint16\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_a6eaf385c919852b0eda0d281580943cd}{ir}}[0]\ <<\ 8)\ |\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint16\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_a6eaf385c919852b0eda0d281580943cd}{ir}}[1]);}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Convert\ Green\ LED:\ combine\ 2\ bytes\ into\ 16-\/bit\ uint16\_t}}
\DoxyCodeLine{\ \ \ \ sample\_out-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_data_aa88bb61a86ace353f4b5b25d07807f9b}{green}}\ =\ ((uint16\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_aa5668b987f1862331ffb4868ab9d0864}{green}}[0]\ <<\ 8)\ |\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((uint16\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_aa5668b987f1862331ffb4868ab9d0864}{green}}[1]);}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Scale\ ADC\ counts\ to\ calibrated\ current\ (nanoamps)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Converts\ 16-\/bit\ ADC\ values\ to\ current\ using:}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Current\ (nA)\ =\ ADC\_Count\ ×\ 0.00781\ nA}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Full\ range:\ 0\ to\ 2048\ nA}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ LSB\ Resolution:\ 7.81\ pA\ per\ count}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ sample\_in\ -\/\ [in]\ Pointer\ to\ MAX30101\_SampleData\ with\ ADC\ counts\ (0–65535)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ sample\_out\ -\/\ [out]\ Pointer\ to\ MAX30101\_SampleCurrent\ for\ current\ in\ nanoamps}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ void}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @retval\ N/A}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ Intermediate\ step\ for\ two-\/phase\ conversion\ pipeline.\ For\ single-\/step}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ FIFO\ read\ +\ conversion,\ use\ MAX30101\_ReadFIFO\_Current()\ instead.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_ReadFIFO\_Current}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_SampleData\ adc\_counts;}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_SampleCurrent\ current;}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_ConvertUint16ToCurrent(\&adc\_counts,\ \&current);}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ printf("{}Red\ LED:\ \%f\ nA\(\backslash\)n"{},\ current.red);\ \ //\ Output\ in\ nanoamps}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ MAX30101\_ConvertUint16ToCurrent(\doxymbox{\hyperlink{struct_m_a_x30101___sample_data}{MAX30101\_SampleData}}\ *sample\_in,\ \doxymbox{\hyperlink{struct_m_a_x30101___sample_current}{MAX30101\_SampleCurrent}}\ *sample\_out)\{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Convert\ Red\ channel\ ADC\ count\ to\ current\ in\ nanoamps}}
\DoxyCodeLine{\ \ \ \ sample\_out-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_current_a5cea7debb6ebf9bed2ad6bbba501f72f}{red}}\ =\ (float32\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_data_aa6c4a1b80cef822bc20df87c653812e8}{red}}\ *\ \doxymbox{\hyperlink{_m_a_x30101_8h_ab646e31650ff0cfc41f9bc2368b9ccdd}{MAX30101\_CURRENT\_LSB\_NA}};}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Convert\ IR\ channel\ ADC\ count\ to\ current\ in\ nanoamps}}
\DoxyCodeLine{\ \ \ \ sample\_out-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_data_a57dfa08dd110be1f466596d1e6080f03}{ir}}\ =\ (float32\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_a6eaf385c919852b0eda0d281580943cd}{ir}}\ *\ \doxymbox{\hyperlink{_m_a_x30101_8h_ab646e31650ff0cfc41f9bc2368b9ccdd}{MAX30101\_CURRENT\_LSB\_NA}};}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Convert\ Green\ channel\ ADC\ count\ to\ current\ in\ nanoamps}}
\DoxyCodeLine{\ \ \ \ sample\_out-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_data_aa88bb61a86ace353f4b5b25d07807f9b}{green}}\ =\ (float32\_t)sample\_in-\/>\doxymbox{\hyperlink{struct_m_a_x30101___sample_aa5668b987f1862331ffb4868ab9d0864}{green}}\ *\ \doxymbox{\hyperlink{_m_a_x30101_8h_ab646e31650ff0cfc41f9bc2368b9ccdd}{MAX30101\_CURRENT\_LSB\_NA}};}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{/**}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @brief\ Optimized\ single-\/step\ FIFO\ read\ with\ direct\ nanoamp\ conversion}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @details\ Combines\ all\ processing\ in\ one\ loop:}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ 1.\ Read\ 6\ raw\ bytes\ from\ FIFO\ per\ sample}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ 2.\ Combine\ bytes\ to\ 16-\/bit\ ADC\ counts}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ 3.\ Scale\ to\ current\ (nA)\ using\ LSB=7.81\ pA}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Output\ directly\ in\ calibrated\ units\ without\ intermediate\ storage.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ samples\ -\/\ [out]\ Pointer\ to\ buffer\ of\ MAX30101\_SampleCurrent\ to\ populate}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @param\ num\_samples\ -\/\ [in]\ Number\ of\ complete\ samples\ to\ read\ and\ convert\ (max\ 32)}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @return\ void}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @retval\ N/A}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @note\ RECOMMENDED\ function\ for\ typical\ usage.\ Minimizes\ memory\ usage\ and\ processing}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ overhead\ compared\ to\ three-\/step\ pipeline\ (Read\ →\ uint16\ →\ nanoamps).}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @warning\ Ensure\ output\ buffer\ has\ capacity\ for\ num\_samples\ structures.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ Total\ bytes\ read\ from\ FIFO:\ num\_samples\ ×\ 6}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @performance\ \string~15-\/20\%\ faster\ and\ \string~24\ bytes\ less\ stack\ vs\ separate\ conversions}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @see\ MAX30101\_GetNumAvailableSamples}}
\DoxyCodeLine{\textcolor{comment}{\ *\ @example}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ MAX30101\_SampleCurrent\ buf[32];}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ uint8\_t\ available\ =\ MAX30101\_GetNumAvailableSamples();}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ if\ (available)\ \{}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ MAX30101\_ReadFIFO\_Current(buf,\ available);}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ //\ buf[0].red\ contains\ Red\ LED\ current\ in\ nanoamps}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ //\ buf[0].ir\ contains\ IR\ LED\ current\ in\ nanoamps}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \ \ \ \ //\ buf[0].green\ contains\ Green\ LED\ current\ in\ nanoamps}}
\DoxyCodeLine{\textcolor{comment}{\ *\ \ \ \}}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ MAX30101\_ReadFIFO\_Current(\doxymbox{\hyperlink{struct_m_a_x30101___sample_current}{MAX30101\_SampleCurrent}}\ *samples,\ uint8\_t\ num\_samples)\{}
\DoxyCodeLine{\ \ \ \ uint8\_t\ fifo\_data[6];}
\DoxyCodeLine{\ \ \ \ uint8\_t\ i;}
\DoxyCodeLine{\ \ \ \ uint16\_t\ temp;}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}(i\ =\ 0;\ i\ <\ num\_samples;\ i++)\{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ read\ 6\ bytes\ from\ FIFO}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ I2C1\_Read(SENSOR\_ADDR,\ FIFO\_DATAREG,\ fifo\_data,\ 6);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ combine\ bytes\ and\ convert\ right\ away}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ temp\ =\ ((uint16\_t)fifo\_data[0]\ <<\ 8)\ |\ fifo\_data[1];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_current_a5cea7debb6ebf9bed2ad6bbba501f72f}{red}}\ =\ (float32\_t)temp\ *\ \doxymbox{\hyperlink{_m_a_x30101_8h_ab646e31650ff0cfc41f9bc2368b9ccdd}{MAX30101\_CURRENT\_LSB\_NA}};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ temp\ =\ ((uint16\_t)fifo\_data[2]\ <<\ 8)\ |\ fifo\_data[3];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_current_a18b81b25ccadd49e2b5ccf3256bbe899}{ir}}\ =\ (float32\_t)temp\ *\ \doxymbox{\hyperlink{_m_a_x30101_8h_ab646e31650ff0cfc41f9bc2368b9ccdd}{MAX30101\_CURRENT\_LSB\_NA}};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ temp\ =\ ((uint16\_t)fifo\_data[4]\ <<\ 8)\ |\ fifo\_data[5];}
\DoxyCodeLine{\ \ \ \ \ \ \ \ samples[i].\doxymbox{\hyperlink{struct_m_a_x30101___sample_current_a436ccdfd169ad2bcf3d3a60893680ced}{green}}\ =\ (float32\_t)temp\ *\ \doxymbox{\hyperlink{_m_a_x30101_8h_ab646e31650ff0cfc41f9bc2368b9ccdd}{MAX30101\_CURRENT\_LSB\_NA}};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
 